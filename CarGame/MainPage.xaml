<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:CarGame.ViewModels"
             x:Class="CarGame.MainPage"
             x:DataType="viewModels:GameHudViewModel"
             BackgroundColor="Black"
             Shell.NavBarIsVisible="False">

    <Grid>
        <!-- Game Canvas -->
        <GraphicsView x:Name="GameView" />

        <!-- HUD -->
        <Grid x:Name="HudGrid" Padding="16" RowDefinitions="Auto,*" InputTransparent="True">
<Grid RowDefinitions="Auto,Auto,Auto"
      ColumnDefinitions="*,*"
      RowSpacing="6"
      ColumnSpacing="18"
      HorizontalOptions="Fill"
      VerticalOptions="Start">

    <!-- Row 0 -->
    <Label
           Text="{Binding ScoreText}"
           TextColor="White"
           FontSize="18"
           Grid.Row="0"
           Grid.Column="0"
           HorizontalTextAlignment="Start" />

    <Label
           Text="{Binding CoinsText}"
           TextColor="White"
           FontSize="18"
           Grid.Row="0"
           Grid.Column="1"
           HorizontalTextAlignment="End" />

    <!-- Row 1 -->
    <Label
           Text="{Binding HighScoreText}"
           TextColor="White"
           FontSize="14"
           Grid.Row="1"
           Grid.Column="0"
           HorizontalTextAlignment="Start" />

    <!-- Row 2 -->
    <Label
           Text="{Binding LivesText}"
           TextColor="White"
           FontSize="18"
           Grid.Row="2"
           Grid.Column="0"
           HorizontalTextAlignment="Start" />

    <Label
           Text="{Binding InvincibleText}"
           TextColor="Yellow"
           FontSize="18"
           IsVisible="{Binding IsInvincible}"
           Grid.Row="2"
           Grid.Column="1"
           HorizontalTextAlignment="End" />
</Grid>
<Label x:Name="HintLabel"
                   Grid.Row="1"
                   Text="Swipe left/right to change lanes"
                   TextColor="White"
                   Opacity="0.8"
                   VerticalOptions="End"
                   HorizontalOptions="Center"
                   Margin="0,0,0,30"/>
        </Grid>

        <!-- Pause button -->
        <Button x:Name="PauseButton"
                Text="Pause"
                WidthRequest="90"
                HeightRequest="42"
                HorizontalOptions="End"
                VerticalOptions="Start"
                Margin="0,12,12,0"
                Command="{Binding PauseCommand}" IsVisible="{Binding CanPause}" />

        <!-- PAUSE MENU OVERLAY (during gameplay) -->
<Grid x:Name="PauseOverlay"
      BackgroundColor="#B0000000"
      IsVisible="{Binding IsPaused}"
      Padding="20">

    <ScrollView VerticalOptions="Center"
                HorizontalOptions="Center"
                HorizontalScrollBarVisibility="Never">

        <Frame Padding="22"
               CornerRadius="22"
               HasShadow="True"
               BackgroundColor="#202020"
               BorderColor="#3A3A3A"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               MaximumWidthRequest="360">

            <VerticalStackLayout Spacing="14"
                                 WidthRequest="260"
                                 HorizontalOptions="Center">

                <Label Text="Paused"
                       FontSize="26"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />

                <Button Text="Resume"
                        WidthRequest="220"
                        HorizontalOptions="Center"
                        Command="{Binding ResumeCommand}" />

                <Button Text="Restart Run"
                        WidthRequest="220"
                        HorizontalOptions="Center"
                        Command="{Binding RestartCommand}" />

                <Button Text="Settings"
                        WidthRequest="220"
                        HorizontalOptions="Center"
                        Command="{Binding SettingsCommand}" />

                <Button Text="Main Menu"
                        WidthRequest="220"
                        HorizontalOptions="Center"
                        Command="{Binding MenuCommand}" />
            </VerticalStackLayout>
        </Frame>
    </ScrollView>
</Grid>

<!-- GAME OVER OVERLAY -->
<Grid x:Name="GameOverOverlay"
      BackgroundColor="#B0000000"
      IsVisible="{Binding IsGameOver}" Padding="20">

            <ScrollView>
<Frame Padding="22"
           CornerRadius="22"
           HasShadow="True"
           BackgroundColor="#202020"
           BorderColor="#3A3A3A"
           HorizontalOptions="Center"
           VerticalOptions="Center">

        <VerticalStackLayout Spacing="12" MaximumWidthRequest="360" HorizontalOptions="Center">
            <Label Text="Game Over"
                   FontSize="28"
                   TextColor="White"
                   HorizontalTextAlignment="Center" />

            <Label x:Name="FinalScoreLabel"
                   Text="{Binding FinalScoreText}"
                   FontSize="16"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />

            <Label x:Name="FinalTimeAliveLabel"
                   Text="{Binding FinalTimeAliveText}"
                   FontSize="16"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />

            <Label x:Name="FinalHighScoreLabel"
                   Text="{Binding FinalHighScoreText}"
                   FontSize="16"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />

            <Label x:Name="FinalCoinsRunLabel"
                   Text="{Binding FinalCoinsRunText}"
                   FontSize="14"
                   TextColor="#AFAFAF"
                   HorizontalTextAlignment="Center" />

            <Label x:Name="FinalCoinsHeldLabel"
                   Text="{Binding FinalCoinsHeldText}"
                   FontSize="14"
                   TextColor="#AFAFAF"
                   HorizontalTextAlignment="Center"
                   Margin="0,-6,0,0" />

            <Label x:Name="NewHighScoreBadgeLabel"
                   Text="NEW HIGH SCORE!"
                   FontSize="14"
                   TextColor="Gold"
                   HorizontalTextAlignment="Center"
                   IsVisible="{Binding IsNewHighScore}"
                   Margin="0,6,0,0" />

            <Button Text="Restart Run"
                    WidthRequest="220"
                    Command="{Binding RestartCommand}" />

            <Button Text="Main Menu"
                    WidthRequest="220"
                    Command="{Binding MenuCommand}" />
        </VerticalStackLayout>
    </Frame>
            </ScrollView>
        </Grid>
        <!-- MAIN MENU OVERLAY -->
        <Grid x:Name="MainMenuOverlay"
              BackgroundColor="#B0000000"
              IsVisible="True" Padding="20">

            <ScrollView VerticalOptions="Center"
                        HorizontalOptions="Center"
                        HorizontalScrollBarVisibility="Never">
<Frame Padding="26"
                   CornerRadius="22"
                   HasShadow="True"
                   BackgroundColor="#202020"
                   BorderColor="#3A3A3A"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   MaximumWidthRequest="360">
                <VerticalStackLayout Spacing="14" HorizontalOptions="Center">
                    <Label Text="Traffic Escape"
                           FontSize="34"
                           TextColor="White"
                           HorizontalTextAlignment="Center" />

                    <Label Text="Avoid cars â€¢ Collect coins"
                           FontSize="14"
                           TextColor="#CFCFCF"
                           HorizontalTextAlignment="Center"
                           Margin="0,0,0,4" />

                    <Label x:Name="TotalCoinsMenuLabel"
                           Text="Coins Held: 0"
                           FontSize="14"
                           TextColor="#CFCFCF"
                           HorizontalTextAlignment="Center"
                           Margin="0,0,0,10" />

                    <Button Text="Play"
                            WidthRequest="220"
                            Clicked="Play_Clicked" />

                    <Button Text="Shop"
                            WidthRequest="220"
                            Clicked="Shop_Clicked" />

                    <Button Text="Settings"
                            WidthRequest="220"
                            Clicked="Settings_Clicked" />

                    <Button Text="?"
                            WidthRequest="220"
                            Clicked="HowTo_Clicked" />
                </VerticalStackLayout>
            </Frame>
            </ScrollView>
        </Grid>

        <!-- SHOP OVERLAY -->
        <Grid x:Name="ShopOverlay"
              BackgroundColor="#B0000000"
              IsVisible="False" Padding="20">

            <ScrollView>
<Frame Padding="22"
                   CornerRadius="22"
                   HasShadow="True"
                   BackgroundColor="#202020"
                   BorderColor="#3A3A3A"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">

                <VerticalStackLayout Spacing="14">
                    <Label Text="Shop"
                           FontSize="22"
                           TextColor="White"
                           HorizontalTextAlignment="Center" />

                    <Label x:Name="TotalCoinsShopLabel"
                           Text="Coins Held: 0"
                           FontSize="14"
                           TextColor="#CFCFCF"
                           HorizontalTextAlignment="Center" />

                    <Label x:Name="SelectedCarLabel"
                           Text="Selected: Yellow"
                           FontSize="14"
                           TextColor="#CFCFCF"
                           HorizontalTextAlignment="Center" />

                    <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">

<HorizontalStackLayout Spacing="16" HorizontalOptions="Center">

    <!-- Yellow (default) -->
    <Frame x:Name="CarYellowFrame"
           Padding="6"
           CornerRadius="16"
           HasShadow="False"
           BackgroundColor="#141414"
           BorderColor="#4A4A4A">
        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
            <ImageButton x:Name="CarYellowButton"
                         Source="car_yellow.png"
                         WidthRequest="90"
                         HeightRequest="120"
                         Clicked="CarYellow_Clicked"
                         BackgroundColor="Transparent" />
            <Label x:Name="CarYellowUnlockLabel"
                   Text="Default"
                   FontSize="12"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </Frame>

    <!-- Purple (25) -->
    <Frame x:Name="CarPurpleFrame"
           Padding="6"
           CornerRadius="16"
           HasShadow="False"
           BackgroundColor="#141414"
           BorderColor="#4A4A4A">
        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
            <ImageButton x:Name="CarRedButton"
                         Source="car_purple.png"
                         WidthRequest="90"
                         HeightRequest="120"
                         Clicked="CarRed_Clicked"
                         BackgroundColor="Transparent" />
            <Label x:Name="CarRedUnlockLabel"
                   Text="25 coins"
                   FontSize="12"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </Frame>

    <!-- Blue (50) -->
    <Frame x:Name="CarBlueFrame"
           Padding="6"
           CornerRadius="16"
           HasShadow="False"
           BackgroundColor="#141414"
           BorderColor="#4A4A4A">
        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
            <ImageButton x:Name="CarBlueButton"
                         Source="car_blue.png"
                         WidthRequest="90"
                         HeightRequest="120"
                         Clicked="CarBlue_Clicked"
                         BackgroundColor="Transparent" />
            <Label x:Name="CarBlueUnlockLabel"
                   Text="50 coins"
                   FontSize="12"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </Frame>

    <!-- Green (75) -->
    <Frame x:Name="CarGreenFrame"
           Padding="6"
           CornerRadius="16"
           HasShadow="False"
           BackgroundColor="#141414"
           BorderColor="#4A4A4A">
        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
            <ImageButton x:Name="CarGreenButton"
                         Source="car_green.png"
                         WidthRequest="90"
                         HeightRequest="120"
                         Clicked="CarGreen_Clicked"
                         BackgroundColor="Transparent" />
            <Label x:Name="CarGreenUnlockLabel"
                   Text="75 coins"
                   FontSize="12"
                   TextColor="#CFCFCF"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </Frame>

</HorizontalStackLayout>

</ScrollView>


                    <Button x:Name="CustomCarUploadButton"
                            Text="Upload Custom Car"
                            Clicked="CustomCarUpload_Clicked" />

                    <Label Text="Tip: use a transparent PNG for the best look."
                           FontSize="12"
                           TextColor="#AFAFAF"
                           HorizontalTextAlignment="Center"
                           Margin="0,-8,0,0" />

                    <BoxView HeightRequest="1" Opacity="0.25" />

                    <Label Text="Upgrades"
                           FontSize="18"
                           TextColor="White"
                           HorizontalTextAlignment="Center" />

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" RowSpacing="10" ColumnSpacing="12">
                        <Label x:Name="HealthUpgradeLabel"
                               Text="Max Health: 3/6"
                               TextColor="#CFCFCF"
                               FontSize="14" />
                        <Button x:Name="HealthUpgradeButton"
                                Grid.Column="1"
                                Text="Buy (50)"
                                Clicked="HealthUpgrade_Clicked" />

                        <Label x:Name="InvUpgradeLabel"
                               Grid.Row="1"
                               Text="Invincibility: 10s"
                               TextColor="#CFCFCF"
                               FontSize="14" />
                        <Button x:Name="InvUpgradeButton"
                                Grid.Row="1"
                                Grid.Column="1"
                                Text="Buy (50)"
                                Clicked="InvUpgrade_Clicked" />
                    </Grid>

                    <Button Text="Back"
                            Clicked="ShopBack_Clicked" />
                </VerticalStackLayout>
            </Frame>
            </ScrollView>
        </Grid>

        <!-- SETTINGS OVERLAY -->
        <Grid x:Name="SettingsOverlay"
              BackgroundColor="#B0000000"
              IsVisible="False" Padding="20">

            <ScrollView>
<Frame Padding="22"
                   CornerRadius="22"
                   HasShadow="True"
                   BackgroundColor="#202020"
                   BorderColor="#3A3A3A"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">

                <VerticalStackLayout Spacing="14" MaximumWidthRequest="360" HorizontalOptions="Center">
                    <Label Text="Settings"
                           FontSize="22"
                           TextColor="White"
                           HorizontalTextAlignment="Center" />

                    <Label x:Name="CoinsHeldSettingsLabel"
                           Text="Coins Held: 0"
                           FontSize="14"
                           TextColor="#CFCFCF"
                           HorizontalTextAlignment="Center" />

                    <Label x:Name="CoinsEarnedSettingsLabel"
                           Text="Total Coins Earned: 0"
                           FontSize="12"
                           TextColor="#AFAFAF"
                           HorizontalTextAlignment="Center"
                           Margin="0,-8,0,0" />
<Grid ColumnDefinitions="*,Auto"
      RowDefinitions="Auto,Auto,Auto"
      ColumnSpacing="12"
      RowSpacing="10"
      HorizontalOptions="Center"
      WidthRequest="280">

    <Label Grid.Row="0" Grid.Column="0"
           Text="Volume"
           TextColor="#CFCFCF"
           FontSize="14" />

    <Label x:Name="VolumeValueLabel"
           Grid.Row="0" Grid.Column="1"
           Text="50%"
           TextColor="#CFCFCF"
           FontSize="14"
           HorizontalTextAlignment="End" />

    <Slider x:Name="VolumeSlider"
            Grid.Row="1"
            Grid.ColumnSpan="2"
            Minimum="0"
            Maximum="1"
            Value="0.5"
            ValueChanged="VolumeSlider_ValueChanged" />

    <Label Grid.Row="2" Grid.Column="0"
           Text="Sound Effects (SFX)"
           TextColor="#CFCFCF"
           FontSize="14"
           VerticalTextAlignment="Center" />

    <Switch x:Name="SfxSwitch"
            Grid.Row="2" Grid.Column="1"
            IsToggled="True"
            Toggled="SfxSwitch_Toggled"
            HorizontalOptions="End" />
</Grid>

<Button x:Name="EraseDataButton"
                            Text="Erase User Data"
                            Clicked="EraseData_Clicked" />

                    <Label x:Name="EraseDataHintLabel"
                           Text="Resets High Score, coins, owned cars, selected car, and upgrades."
                           FontSize="12"
                           TextColor="#AFAFAF"
                           HorizontalTextAlignment="Center" />

                    <Button Text="Back"
                            Clicked="SettingsBack_Clicked" />
                </VerticalStackLayout>
            </Frame>
            </ScrollView>
        </Grid>

        <!-- HOW TO PLAY OVERLAY -->
        <Grid x:Name="HowToOverlay"
              BackgroundColor="#B0000000"
              IsVisible="False">
            <Frame Padding="12"
                   CornerRadius="22"
                   HasShadow="True"
                   BackgroundColor="#202020"
                   BorderColor="#3A3A3A"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">
                <Grid RowDefinitions="*,Auto">
                    <ScrollView>
                        <Image Source="howtoplay.png" Aspect="AspectFit" />
                    </ScrollView>

                    <Button Grid.Row="1" Text="Close" Clicked="HowToClose_Clicked" />
                </Grid>
            </Frame>
        </Grid>
    </Grid>

</ContentPage>

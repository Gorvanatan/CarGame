<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CarGame.Pages.ShopPage"
             BackgroundColor="Black"
             Shell.NavBarIsVisible="False">

    <Grid>

        <Image Source="backgroundgarage.jpg" Aspect="AspectFill" />

        <BoxView Color="#66000000" />

        <!-- Smaller padding on Android so upgrade row doesn't clip on narrow screens -->
        <Grid Padding="{OnPlatform Android='12', iOS='20', WinUI='20', MacCatalyst='20'}" RowDefinitions="Auto,*">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="6" HorizontalOptions="Center">
            <Label Text="Shop"
                   TextColor="White"
                   FontSize="28"
                   HorizontalTextAlignment="Center" />

            <Label Text="{Binding CoinsHeldText}"
                   TextColor="#CFCFCF"
                   FontSize="14"
                   HorizontalTextAlignment="Center" />

            <Label Text="{Binding SelectedCarText}"
                   TextColor="#AFAFAF"
                   FontSize="12"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <!-- Body -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="16" Padding="0,14,0,20" HorizontalOptions="FillAndExpand">

                <!-- Cars -->
                <Label Text="Cars"
                       TextColor="White"
                       FontSize="18"
                       HorizontalTextAlignment="Center" />

                <CollectionView ItemsSource="{Binding Cars}"
                                ItemsLayout="HorizontalList"
                                HorizontalScrollBarVisibility="Never"
                                SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="8"
                                   CornerRadius="16"
                                   HasShadow="False"
                                   BackgroundColor="#141414"
                                   BorderColor="#4A4A4A"
                                   Margin="8,0">

                                <Frame.Triggers>
                                    <DataTrigger TargetType="Frame" Binding="{Binding IsOwned}" Value="True">
                                        <Setter Property="BorderColor" Value="#4CAF50" />
                                    </DataTrigger>
                                    <DataTrigger TargetType="Frame" Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BorderColor" Value="Gold" />
                                        <Setter Property="BackgroundColor" Value="#252525" />
                                    </DataTrigger>
                                </Frame.Triggers>

                                <VerticalStackLayout Spacing="8" WidthRequest="140" HorizontalOptions="Center">
                                    <Image Source="{Binding ImageSource}"
                                           WidthRequest="90"
                                           HeightRequest="120"
                                           HorizontalOptions="Center" />

                                    <Label Text="{Binding DisplayName}"
                                           TextColor="White"
                                           FontSize="14"
                                           HorizontalTextAlignment="Center" />

                                    <Button Text="{Binding ActionText}"
                                            Command="{Binding BindingContext.SelectOrBuyCarCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                            CommandParameter="{Binding .}"
                                            WidthRequest="120"
                                            HorizontalOptions="Center" />
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Custom car upload (still uses a picker in code-behind) -->
                    <Button Text="Upload Custom Car"
                        WidthRequest="240"
                        HorizontalOptions="Center"
                        Clicked="UploadCustomCar_Clicked" />

                    

                <!-- Upgrades -->
                <Label Text="Upgrades"
                       TextColor="White"
                       FontSize="18"
                       HorizontalTextAlignment="Center" />

                <!-- No fixed WidthRequest: lets the layout shrink on small Android screens -->
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,Auto"
                      RowSpacing="10"
                      ColumnSpacing="12"
                      HorizontalOptions="FillAndExpand">

                    <Label Text="{Binding MaxHealthText}"
                           TextColor="#CFCFCF"
                           FontSize="14"
                           LineBreakMode="WordWrap"
                           Grid.Row="0" Grid.Column="0" />

                    <Button Text="{Binding HealthUpgradeButtonText}"
                            Command="{Binding BuyHealthUpgradeCommand}"
                            IsEnabled="{Binding CanBuyHealthUpgrade}"
                            Grid.Row="0" Grid.Column="1" />

                    <Label Text="{Binding InvincibilityText}"
                           TextColor="#CFCFCF"
                           FontSize="14"
                           LineBreakMode="WordWrap"
                           Grid.Row="1" Grid.Column="0" />

                    <Button Text="{Binding InvUpgradeButtonText}"
                            Command="{Binding BuyInvUpgradeCommand}"
                            IsEnabled="{Binding CanBuyInvUpgrade}"
                            Grid.Row="1" Grid.Column="1" />

                </Grid>

                <Button Text="Back"
                        Command="{Binding BackCommand}"
                        WidthRequest="220"
                        HorizontalOptions="Center" />
            </VerticalStackLayout>
        </ScrollView>

        </Grid>

    </Grid>
</ContentPage>
